function h_fig = view_dpoae_params(command_str,stim_num)		%function to create graphic interface for setting behavior paramsglobal PARAMSh_fig = findobj('Tag','View_DPOAE_Params_fig');if nargin < 1										%call from sens.m doesn't have input arguments so set command stsring to initialize    command_str = 'initialize';    stim_num = 0;    txt_num = 0;endif ~strcmp(command_str,'initialize')		%entering the program via callback (command_str is not initialize) so retrieve figure handles    handles        = get(gcf,'userdata');		%	that were created during previous initialization	    h_push_defs   = handles(1);    h_push_update  = handles(2);    h_push_close   = handles(3);    h_push_left    = handles(4);    h_push_right   = handles(5);    h_push_both    = handles(6);    parm_txt       = handles(7:24);    h_edit         = handles(25);endif strcmp(command_str,'initialize')				%the following code generates the image and throws ups pop menus with current params    if (ishandle(h_fig))        delete(h_fig);    end    h_fig = figure('NumberTitle','off','Name','Parameters','Units','pixels', ...        'Tag','View_dpoae_Params_fig', 'position',[100 100 800 560]); %open window for the TDT GUI    h_ax = axes('Position',[0 0 1 1]);	%set up axes equal in size to the jpeg    axis('off');        text(.3,.75,'Parameter','fontsize',16,'color','k','horizontalalignment','center','VerticalAlignment','middle');    text(.5,.75,'Value','fontsize',16,'color','k','horizontalalignment','center','VerticalAlignment','middle');    text(.7,.75,'Input','fontsize',16,'color','k','horizontalalignment','center','VerticalAlignment','middle');        text(.37,.70,'Low Freq (kHz):','fontsize',12,'horizontalalignment','right','VerticalAlignment','middle');    text(.37,.67,'High Freq (kHz):','fontsize',12,'horizontalalignment','right','VerticalAlignment','middle');    text(.37,.64,'# Steps (log&lin: #/oct; Q: # in BW10):','fontsize',12,'horizontalalignment','right','VerticalAlignment','middle');    text(.37,.61,'Log Step (yes,no,Q):','fontsize',12,'horizontalalignment','right','VerticalAlignment','middle');    text(.37,.53,'Tone On (msec):','fontsize',12,'horizontalalignment','right','VerticalAlignment','middle');    text(.37,.50,'Tone Off (msec):','fontsize',12,'horizontalalignment','right','VerticalAlignment','middle');    text(.37,.47,'F2/F1 Ratio:','fontsize',12,'horizontalalignment','right','VerticalAlignment','middle');    text(.37,.39,'A/D Duration (msec):','fontsize',12,'horizontalalignment','right','VerticalAlignment','middle');    text(.37,.36,'Number of Reps:','fontsize',12,'horizontalalignment','right','VerticalAlignment','middle');    text(.37,.28,'Calibration Level (dBSPL):','fontsize',12,'horizontalalignment','right','VerticalAlignment','middle');    text(.37,.25,'F2 Level (dBSPL):','fontsize',12,'horizontalalignment','right','VerticalAlignment','middle');    text(.37,.17,'F1 Level (dBSPL):','fontsize',12,'horizontalalignment','right','VerticalAlignment','middle');    text(.37,.14,'Microphone Gain(dB):','fontsize',12,'horizontalalignment','right','VerticalAlignment','middle');%     text(.37,.11,'Pre-Spont Interval (sec):','fontsize',12,'horizontalalignment','right','VerticalAlignment','middle');%     text(.37,.08,'Post-Spont Interval (sec):','fontsize',12,'horizontalalignment','right','VerticalAlignment','middle');        if PARAMS(4) == 0,       log_txt = 'no';    elseif PARAMS(4) > 0,       log_txt = 'yes';    else       log_txt = 'Q';    end           parm_txt(1)  = text(.535,.70,num2str(PARAMS(1)), 'fontsize',12,'color',[.1 .1 .6],'horizontalalignment','right','VerticalAlignment','middle','buttondownfcn','view_dpoae_params(''stimulus'',1);');    parm_txt(2)  = text(.535,.67,num2str(PARAMS(2)), 'fontsize',12,'color',[.1 .1 .6],'horizontalalignment','right','VerticalAlignment','middle','buttondownfcn','view_dpoae_params(''stimulus'',2);');    parm_txt(3)  = text(.535,.64,num2str(max(PARAMS(3),abs(PARAMS(4)))),'fontsize',12,'color',[.1 .1 .6],'horizontalalignment','right','VerticalAlignment','middle','buttondownfcn','view_dpoae_params(''stimulus'',3);');    parm_txt(4)  = text(.535,.61,log_txt,'fontsize',12,'color',[.1 .1 .6],'horizontalalignment','right','VerticalAlignment','middle','buttondownfcn','view_dpoae_params(''stimulus'',4);');    parm_txt(5)  = text(.535,.53,num2str(PARAMS(5)), 'fontsize',12,'color',[.1 .1 .6],'horizontalalignment','right','VerticalAlignment','middle','buttondownfcn','view_dpoae_params(''stimulus'',5);');    parm_txt(6)  = text(.535,.50,num2str(PARAMS(6)), 'fontsize',12,'color',[.1 .1 .6],'horizontalalignment','right','VerticalAlignment','middle','buttondownfcn','view_dpoae_params(''stimulus'',6);');    parm_txt(7)  = text(.535,.47,num2str(PARAMS(7)), 'fontsize',12,'color',[.1 .1 .6],'horizontalalignment','right','VerticalAlignment','middle','buttondownfcn','view_dpoae_params(''stimulus'',7);');    parm_txt(8)  = text(.535,.39,num2str(PARAMS(8)), 'fontsize',12,'color',[.1 .1 .6],'horizontalalignment','right','VerticalAlignment','middle','buttondownfcn','view_dpoae_params(''stimulus'',8);');    parm_txt(9)  = text(.535,.36,num2str(PARAMS(9)), 'fontsize',12,'color',[.1 .1 .6],'horizontalalignment','right','VerticalAlignment','middle','buttondownfcn','view_dpoae_params(''stimulus'',9);');    parm_txt(10)  = text(.535,.30,num2str(PARAMS(10)), 'fontsize',12,'color',[.1 .1 .6],'horizontalalignment','right','VerticalAlignment','middle','buttondownfcn','view_dpoae_params(''stimulus'',10);');    parm_txt(11)  = text(.535,.28,num2str(PARAMS(11)), 'fontsize',12,'color',[.1 .1 .6],'horizontalalignment','right','VerticalAlignment','middle','buttondownfcn','view_dpoae_params(''stimulus'',11);');    parm_txt(12)  = text(.535,.25,num2str(PARAMS(12)), 'fontsize',12,'color',[.1 .1 .6],'horizontalalignment','right','VerticalAlignment','middle','buttondownfcn','view_dpoae_params(''stimulus'',12);');    parm_txt(13)  = text(.435,.17,num2str(PARAMS(13)), 'fontsize',12,'color',[.1 .1 .6],'horizontalalignment','right','VerticalAlignment','middle','buttondownfcn','view_dpoae_params(''stimulus'',13);');      %the following menus change behavioral parameters held in global PARAMS    h_push_def  = uicontrol(h_fig,'callback','view_dpoae_params(''reset'',0);','style','pushbutton','Units','normalized','position',[.3 .85 .1 .05],'string','Default');    h_push_update = uicontrol(h_fig,'callback','view_dpoae_params(''update'',0);','style','pushbutton','Units','normalized','position',[.45 .85 .1 .05],'string','Update','Enable','off','Foregroundcolor','r');    h_push_close  = uicontrol(h_fig,'callback','view_dpoae_params(''close'',0);','style','pushbutton','Units','normalized','position',[.6 .85 .1 .05],'string','Close');    h_push_left   = uicontrol(h_fig,'callback','view_dpoae_params(''left'',0);','style','radio','Units','normalized','position',[.65 .43 .15 .04],'string','Left Ear','Value',0,'fontname','helvetica','fontsize',12,'BackGroundColor','w');    h_push_right  = uicontrol(h_fig,'callback','view_dpoae_params(''right'',0);','style','radio','Units','normalized','position',[.65 .39 .15 .04],'string','Right Ear','Value',0,'fontname','helvetica','fontsize',12,'BackGroundColor','w');    h_push_both   = uicontrol(h_fig,'callback','view_dpoae_params(''both'',0);','style','radio','Units','normalized','position',[.65 .35 .15 .04],'string','Both Ears','Value',0,'fontname','helvetica','fontsize',12,'BackGroundColor','w');    h_edit        = uicontrol(h_fig,'style','edit','Units','normalized','position',[.63 .66 .15 .05],'string',[],'FontSize',14);								    switch PARAMS(10)    case 1, set(h_push_left,'value',1);    case 2,  set(h_push_right,'value',1);    case 3,  set(h_push_both,'value',1);    end        %set up handles required by callbacks from menus							    handles = [h_push_def h_push_update h_push_close h_push_left h_push_right h_push_both parm_txt h_edit];    set(h_fig,'userdata',handles);        elseif strcmp(command_str,'reset')						%the reset call allows you to load saved workspace if incorrect settings have been entered    PARAMS(1)  =  0.5;    PARAMS(2)  = 10.0;    PARAMS(3)  =    0;    PARAMS(4)  =    2;    PARAMS(5)  =    1;    PARAMS(6)  = 2000;    PARAMS(7)  = 1000;    PARAMS(8)  =  1.2;    PARAMS(9)  = 2020;    PARAMS(10) =    8;    PARAMS(11) =98.75;    PARAMS(12) =   75;    PARAMS(13) =   75;    PARAMS(13) =   40;        if PARAMS(4) == 0,       log_txt = 'no';    elseif PARAMS(4) > 0,       log_txt = 'yes';    else       log_txt = 'Q';    end        switch PARAMS(5)    case 1,        set(h_push_left,'value',1);        set(h_push_right,'value',0);        set(h_push_both,'value',0);    case 2,        set(h_push_left,'value',0);        set(h_push_right,'value',1);        set(h_push_both,'value',0);    case 3,        set(h_push_left,'value',0);        set(h_push_right,'value',0);        set(h_push_both,'value',1);    end    for i = [1:2,6:13],        set(parm_txt(i),'String',num2str(PARAMS(i)));    end    set(parm_txt(3),'String',num2str(max(PARAMS(3),abs(PARAMS(4)))));    set(parm_txt(4),'String',log_txt);    set(h_push_update,'Enable','on');     elseif strcmp(command_str,'stimulus')    if length(get(h_edit,'string'))       new_value = get(h_edit,'string');       set(h_edit,'String',[]);       if stim_num == 4,          if strncmp(new_value,'y',1) | str2num(new_value)==1,             set(parm_txt(4),'String','yes');             PARAMS(4) = max(PARAMS(3),abs(PARAMS(4)));             PARAMS(3) = 0;          elseif strncmp(new_value,'Q',1),             set(parm_txt(4),'String','Q');             PARAMS(4) = -max(PARAMS(3),abs(PARAMS(4)));  % Store #steps as NEGATIVE for Qspaced             PARAMS(3) = 0;          else             set(parm_txt(4),'String','no');             PARAMS(3) = max(PARAMS(3),abs(PARAMS(4)));             PARAMS(4) = 0;          end       elseif stim_num == 3,          set(parm_txt(3),'String',new_value);          if PARAMS(3) > abs(PARAMS(4)),             PARAMS(3) = str2num(new_value);          elseif PARAMS(4)>0             PARAMS(4) = str2num(new_value);          else             PARAMS(4) = -str2num(new_value);          end       else          set(parm_txt(stim_num),'String',new_value);          PARAMS(stim_num) = str2num(new_value);       end       set(h_push_update,'Enable','on');    else       set(h_edit,'String','ERROR');    end    elseif strcmp(command_str,'left')    PARAMS(5) = 1;    set(h_push_left,'value',1);    set(h_push_right,'value',0);    set(h_push_both,'value',0);    set(h_push_update,'Enable','on');elseif strcmp(command_str,'right')    PARAMS(5) = 2;    set(h_push_left,'value',0);    set(h_push_right,'value',1);    set(h_push_both,'value',0);    set(h_push_update,'Enable','on');elseif strcmp(command_str,'both')    PARAMS(5) = 3;    set(h_push_left,'value',0);    set(h_push_right,'value',0);    set(h_push_both,'value',1);    set(h_push_update,'Enable','on');elseif strcmp(command_str,'update')			% after parameters have been changed they need to be recorded in subject's parameter file    eval('update_dpoae_params');						% use function update_dpoae_params to rewrite the file    set(h_push_update,'Enable','off');    view_dpoae_params('close');elseif strcmp(command_str,'close')			% clear, close and then restart the sens.m program    close('Parameters');    tuning_curve('return from parameter change');end